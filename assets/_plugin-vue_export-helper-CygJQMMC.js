function k(e){return e?`/auth/login/${e}`:"/auth/login"}var d="/",x=(e,t)=>(e.endsWith(d)&&(e=e.slice(0,-1)),t.startsWith(d)||(t=d+t),e+t),g=(e,t,r)=>{let s=e.pathname===d?t:x(e.pathname,t),a=new globalThis.URL(s,e);if(r)for(let[o,i]of Object.entries(A(r)))if(i&&typeof i=="object"&&!Array.isArray(i))for(let[l,u]of Object.entries(i))a.searchParams.set(`${o}[${l}]`,String(u));else a.searchParams.set(o,i);return a};function C(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function N(e){var t;if(!(typeof e!="object"||!e)){if(C(e)){let r=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(r!=null&&r.startsWith("application/json")||r!=null&&r.startsWith("application/health+json")){let s=await e.json();if(!e.ok)throw s;return"data"in s?s.data:s}if(r!=null&&r.startsWith("text/html")||r!=null&&r.startsWith("text/plain")){let s=await e.text();if(!e.ok)throw s;return s}return e}return"data"in e?e.data:e}}var y=async(e,t,r=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},r(e,t).then(s=>N(s).catch(a=>{let o=typeof a=="object"&&"errors"in a?a.errors:a;return Promise.reject({errors:o,response:s})}))),J=()=>{let e=null;return{get:async()=>e,set:async t=>{e=t}}},E={msRefreshBeforeExpires:3e4,autoRefresh:!0},P=2**31-1,W=(e="cookie",t={})=>r=>{let s={...E,...t},a=null,o=null,i=s.storage??J(),l=async()=>i.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),u=async()=>{try{await a}finally{a=null}},m=async()=>{let n=await i.get();return a||!(n!=null&&n.expires_at)||n.expires_at<new Date().getTime()+s.msRefreshBeforeExpires&&b().catch(c=>{}),u()},w=async n=>{let c=n.expires??0;n.expires_at=new Date().getTime()+c,await i.set(n),s.autoRefresh&&c>s.msRefreshBeforeExpires&&c<P&&(o&&clearTimeout(o),o=setTimeout(()=>{o=null,b().catch(f=>{})},c-s.msRefreshBeforeExpires))},b=async()=>(a=(async()=>{let n=await i.get();await l();let c={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in s&&(c.credentials=s.credentials);let f={mode:e};e==="json"&&(n!=null&&n.refresh_token)&&(f.refresh_token=n.refresh_token),c.body=JSON.stringify(f);let h=g(r.url,"/auth/refresh");return y(h.toString(),c,r.globals.fetch).then(p=>w(p).then(()=>p))})(),a);return{refresh:b,async login(n,c,f={}){await l();let h={email:n,password:c};"otp"in f&&(h.otp=f.otp),h.mode=f.mode??e;let p=k(f.provider),R=g(r.url,p),S={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)};"credentials"in s&&(S.credentials=s.credentials);let T=await y(R.toString(),S,r.globals.fetch);return await w(T),T},async logout(){let n=await i.get(),c={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in s&&(c.credentials=s.credentials);let f={mode:e};e==="json"&&(n!=null&&n.refresh_token)&&(f.refresh_token=n.refresh_token),c.body=JSON.stringify(f);let h=g(r.url,"/auth/logout");await y(h.toString(),c,r.globals.fetch),this.stopRefreshing(),await l()},stopRefreshing(){o&&clearTimeout(o)},async getToken(){var n;return await m().catch(()=>{}),((n=await i.get())==null?void 0:n.access_token)??null},async setToken(n){return i.set({access_token:n,refresh_token:null,expires:null,expires_at:null})}}},j={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},q=(e,t={})=>{let r=t.globals?{...j,...t.globals}:j;return{globals:r,url:new r.URL(e),with(s){return{...this,...s(this)}}}},L=(e,t,r={})=>()=>{let s=k(r.provider),a={email:e,password:t};return"otp"in r&&(a.otp=r.otp),a.mode=r.mode??"cookie",{path:s,method:"POST",body:JSON.stringify(a)}},U=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}});function O(e){return["directus_access","directus_activity","directus_collections","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var I=(e,t,r)=>()=>{let s=String(e);if(O(s))throw new Error("Cannot use createItems for core collections");return{path:`/items/${s}`,params:r??{},body:JSON.stringify(t),method:"POST"}},D=(e,t)=>()=>({path:"/users",params:t??{},body:JSON.stringify(e),method:"POST"}),$=e=>{let t=(r,s=[])=>{if(typeof r=="object"){let a=[];for(let o in r){let i=r[o]??[];if(Array.isArray(i))for(let l of i)a.push(t(l,[...s,o]));else if(typeof i=="object")for(let l of Object.keys(i)){let u=i[l];for(let m of u)a.push(t(m,[...s,`${o}:${l}`]))}}return a.flatMap(o=>o)}return[...s,String(r)].join(".")};return e.flatMap(r=>t(r))},A=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=$(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[r,s]of Object.entries(e))r in t||(typeof s=="string"||typeof s=="number"||typeof s=="boolean"?t[r]=String(s):t[r]=JSON.stringify(s));return t},_=(e,t)=>{if(e.length===0)throw new Error(t)},v=(e,t)=>{if(O(String(e)))throw new Error(t)},G=(e,t)=>()=>(_(String(e),"Collection cannot be empty"),v(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),H=(e,t,r,s)=>()=>(_(String(t),"Key cannot be empty"),_(String(e),"Collection cannot be empty"),v(e,"Cannot use updateItem for core collections"),{path:`/items/${e}/${t}`,params:s??{},body:JSON.stringify(r),method:"PATCH"}),B={},K=(e={})=>t=>{let r={...B,...e};return{async request(s){let a=s();if(a.headers||(a.headers={}),"Content-Type"in a.headers?a.headers["Content-Type"]==="multipart/form-data"&&delete a.headers["Content-Type"]:a.headers["Content-Type"]="application/json","getToken"in this){let u=await this.getToken();u&&(a.headers||(a.headers={}),a.headers.Authorization=`Bearer ${u}`)}let o=g(t.url,a.path,a.params),i={method:a.method??"GET",headers:a.headers??{}};"credentials"in r&&(i.credentials=r.credentials),a.body&&(i.body=a.body),a.onRequest&&(i=await a.onRequest(i)),r.onRequest&&(i=await r.onRequest(i));let l=await y(o.toString(),i,t.globals.fetch);return"onResponse"in a&&(l=await a.onResponse(l,i)),"onResponse"in e&&(l=await e.onResponse(l,i)),l}}};const M=(e,t)=>{const r=e.__vccOpts||e;for(const[s,a]of t)r[s]=a;return r};export{H as E,I as N,K as R,M as _,U as g,q as l,W as n,L as q,G as w,D as y};
