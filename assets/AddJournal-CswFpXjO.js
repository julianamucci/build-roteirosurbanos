import{u as S,i as D,r as i,j as U,c as v,a as r,w as y,v as _,k as b,f as k,o as g,p as E,h as P}from"./index-CK9AeHb-.js";import{_ as R,l as V,R as C,E as F,N as L,w as N,g as B}from"./_plugin-vue_export-helper-Cb67RjJj.js";const M={setup(){const n=S(),a=D(),c=i(a.query.journalId),t=i(""),p=i(""),l=i(null),s=i(""),w=i(""),m=i(null),d=i(!1),I=e=>`https://admin.roteirosurbanos.com.br/assets/${e}`,f=V("https://admin.roteirosurbanos.com.br/").with(C());U(c,async e=>{if(e)try{d.value=!0;const o=await f.request(N("journals",{filter:{id:{_eq:e}},fields:["title","description","country","city","photo"]}));t.value=o[0].title,p.value=o[0].description,s.value=o[0].country,w.value=o[0].city,m.value=I(o[0].photo)}catch(o){console.error("Error fetching journal:",o)}finally{d.value=!1}},{immediate:!0});const q=e=>{l.value=e;const o=new FileReader;o.onload=h=>{m.value=h.target.result},o.readAsDataURL(e)},x=async()=>{try{if(!l.value)return null;const e=new FormData;e.append("file",l.value);const o=await f.request(B(e));if(o&&o.id)return o.id;throw console.error("Unexpected response format:",o),new Error("Invalid response format or missing expected data")}catch(e){throw console.error("Image upload failed:",e),e}};return{title:t,description:p,photo:l,country:s,city:w,photoPreview:m,isLoading:d,handleFile:q,handleSubmit:async()=>{d.value=!0;try{let e;if(l.value)e=await x();else{const j=m.value.match(/\/assets\/(.+)$/);e=j?j[1]:null}const o={title:t.value,description:p.value,country:s.value,city:w.value,photo:e};let h;c.value?h=await f.request(F("journals",c.value,o)):h=await f.request(L("journals",o)),n.push({name:"readjournal"})}catch(e){console.error("Journal submission failed:",e),e.response&&console.error("Error response data:",e.response.data)}finally{d.value=!1}}}}},u=n=>(E("data-v-34e1c90d"),n=n(),P(),n),T={class:"add-journal-container"},A={class:"form-group"},J=u(()=>r("label",{for:"title"},"Title:",-1)),z={class:"form-group"},G=u(()=>r("label",{for:"description"},"Description:",-1)),H={class:"form-group"},K=u(()=>r("label",{for:"city"},"City:",-1)),O={class:"form-group"},Q=u(()=>r("label",{for:"country"},"Country:",-1)),W={class:"form-group"},X=u(()=>r("label",{for:"photo"},"Photo:",-1)),Y={key:0,class:"photo-preview"},Z=["src"],$={key:1,type:"submit"},ee={key:2};function te(n,a,c,t,p,l){return g(),v("div",T,[r("form",{onSubmit:a[5]||(a[5]=k((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[r("div",A,[J,y(r("input",{type:"text",id:"title","onUpdate:modelValue":a[0]||(a[0]=s=>t.title=s),required:""},null,512),[[_,t.title]])]),r("div",z,[G,y(r("textarea",{id:"description","onUpdate:modelValue":a[1]||(a[1]=s=>t.description=s),required:""},null,512),[[_,t.description]])]),r("div",H,[K,y(r("input",{type:"text",id:"city","onUpdate:modelValue":a[2]||(a[2]=s=>t.city=s),required:""},null,512),[[_,t.city]])]),r("div",O,[Q,y(r("input",{type:"text",id:"country","onUpdate:modelValue":a[3]||(a[3]=s=>t.country=s),required:""},null,512),[[_,t.country]])]),r("div",W,[X,r("input",{type:"file",id:"photo",onChange:a[4]||(a[4]=s=>t.handleFile(s.target.files[0]))},null,32)]),t.photoPreview?(g(),v("div",Y,[r("img",{src:t.photoPreview,alt:"Photo Preview"},null,8,Z)])):b("",!0),t.isLoading?b("",!0):(g(),v("button",$,"Submit")),t.isLoading?(g(),v("div",ee,"Submitting...")):b("",!0)],32)])}const ae=R(M,[["render",te],["__scopeId","data-v-34e1c90d"]]);export{ae as default};
